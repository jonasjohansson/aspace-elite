<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sender</title>
<style>
  @font-face {
    font-family: 'PP NeueBit';
    src: url('fonts/PPNeueBit-Regular.woff2') format('woff2'),
        url('fonts/PPNeueBit-Regular.woff') format('woff'),
        url('fonts/PPNeueBit-Regular.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
    font-display: swap;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body { height: 100%; }
  body { font-family: 'PP NeueBit', sans-serif; padding: 12px; font-size: 13px; display: flex; flex-direction: column; }
  label { display: block; margin: 6px 0 2px; font-size: 11px; }
  input[type="range"] { width: 100%; }
  textarea { width: 100%; padding: 4px 6px; font-family: inherit; font-size: 16px; height: 40px; resize: vertical; }
  .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .val { font-family: monospace; font-size: 11px; }
  input[type="number"] { width: 60px; font-family: monospace; font-size: 14px; padding: 2px 4px; }
  .width-row { display: flex; align-items: center; gap: 6px; }
  .width-row input[type="range"] { flex: 1; }
  .reset { font-size: 10px; cursor: pointer; padding: 2px 6px; }
  .status { margin-bottom: 8px; font-size: 11px; }
  .dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #f44; vertical-align: middle; margin-right: 4px; }
  .dot.on { background: #4f4; }
  hr { margin: 10px 0; }
  button { padding: 6px 12px; cursor: pointer; font-size: 13px; font-family: inherit; }
  .checks label { display: inline; margin-right: 12px; font-size: 13px; }
  .btn-grid { display: flex; flex-wrap: wrap; gap: 6px; }
  #results { font-family: monospace; font-size: 11px; padding: 8px; margin-top: 8px; flex: 1; overflow-y: auto; white-space: pre-wrap; border: 1px solid #ddd; }
  @media (max-width: 480px) {
    .row { grid-template-columns: 1fr; }
    button { flex: 1; min-width: 0; }
  }
</style>
</head>
<body>
<div class="status"><span class="dot" id="dot"></span> <span id="conn">disconnected</span> &nbsp; <span id="counts">S:0 R:0</span></div>

<div class="row">
  <div class="col">
    <label>Col 1 width</label>
    <div class="width-row">
      <input type="range" id="col1Width" min="0" max="10000" value="4752" oninput="syncNum('col1Width','col1Num');send()">
      <input type="number" id="col1Num" min="0" max="10000" value="4752" oninput="syncRange('col1Width','col1Num');send()">
      <button class="reset" onclick="resetWidth('col1Width','col1Num',4752)">reset</button>
    </div>
    <label>Col 1 color</label>
    <input type="color" id="col1Color" value="#ffffff" oninput="send()">
    <label>Col 1 text</label>
    <textarea id="text1" oninput="send()">Hello</textarea>
  </div>
  <div class="col">
    <label>Col 2 width</label>
    <div class="width-row">
      <input type="range" id="col2Width" min="0" max="10000" value="5940" oninput="syncNum('col2Width','col2Num');send()">
      <input type="number" id="col2Num" min="0" max="10000" value="5940" oninput="syncRange('col2Width','col2Num');send()">
      <button class="reset" onclick="resetWidth('col2Width','col2Num',5940)">reset</button>
    </div>
    <label>Col 2 color</label>
    <input type="color" id="col2Color" value="#0000ff" oninput="send()">
    <label>Col 2 text</label>
    <textarea id="text2" oninput="send()">World</textarea>
  </div>
</div>

<label>Gap</label>
<div class="width-row">
  <input type="range" id="gapWidth" min="0" max="5000" value="0" oninput="syncNum('gapWidth','gapNum');send()">
  <input type="number" id="gapNum" min="0" max="5000" value="0" oninput="syncRange('gapWidth','gapNum');send()">
  <button class="reset" onclick="resetWidth('gapWidth','gapNum',0)">reset</button>
</div>

<label>Shape speed <span class="val" id="vspeed">3</span></label>
<input type="range" id="shapeSpeed" min="0" max="20" value="3" step="0.5" oninput="document.getElementById('vspeed').textContent=this.value;send()">
<button onclick="pulse()" style="margin-top:6px;">Bang</button>

<hr>
<div class="row">
  <div>
    <label>Left media</label>
    <select id="media1" onchange="send()" style="width:100%;font-size:13px;padding:4px;">
      <option value="none">None</option>
      <option value="video">Video</option>
      <option value="image">Image</option>
    </select>
  </div>
  <div>
    <label>Right media</label>
    <select id="media2" onchange="send()" style="width:100%;font-size:13px;padding:4px;">
      <option value="none">None</option>
      <option value="video">Video</option>
      <option value="image">Image</option>
    </select>
  </div>
</div>
<label>Media fit</label>
<select id="mediaFit" onchange="send()" style="width:100%;font-size:13px;padding:4px;">
  <option value="cover">Cover</option>
  <option value="contain">Contain</option>
</select>

<hr>
<p style="font-size:11px;margin-bottom:8px;line-height:1.5;">
<b>Ping</b> — measures round-trip latency (sender &rarr; server &rarr; receiver &rarr; server &rarr; sender). Lower is better.<br>
<b>Burst</b> — fires N messages at once and measures how fast the receiver processes all of them (throughput in msg/s).<br>
<b>Stream</b> — sends continuous updates at 30 or 60fps for 5 seconds to test sustained real-time performance.
</p>
<div class="btn-grid">
  <button onclick="ping()">Ping x10</button>
  <button onclick="burst(100)">Burst 100</button>
  <button onclick="burst(500)">Burst 500</button>
  <button onclick="stream(30)">Stream 30fps</button>
  <button onclick="stream(60)">Stream 60fps</button>
  <button onclick="document.getElementById('results').textContent=''">Clear</button>
</div>
<div id="results"></div>

<script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
<script>
  const socket = io('https://aspace-elite-server.onrender.com');

  socket.on('connect', () => { document.getElementById('dot').classList.add('on'); document.getElementById('conn').textContent = 'connected'; socket.emit('register', 'sender'); });
  socket.on('disconnect', () => { document.getElementById('dot').classList.remove('on'); document.getElementById('conn').textContent = 'disconnected'; });
  socket.on('clients', (d) => { document.getElementById('counts').textContent = `S:${d.senders} R:${d.receivers}`; });

  function val(id) { return document.getElementById(id).value; }

  function syncNum(rangeId, numId) { document.getElementById(numId).value = document.getElementById(rangeId).value; }
  function syncRange(rangeId, numId) { document.getElementById(rangeId).value = document.getElementById(numId).value; }
  function resetWidth(rangeId, numId, def) { document.getElementById(rangeId).value = def; document.getElementById(numId).value = def; send(); }

  function getSettings() {
    return {
      col1Width: +val('col1Width'), col2Width: +val('col2Width'), gapWidth: +val('gapWidth'),
      col1Color: val('col1Color'), col2Color: val('col2Color'),
      text1: val('text1'), text2: val('text2'),
      media1: val('media1'),
      media2: val('media2'),
      mediaFit: val('mediaFit'),
      shapeSpeed: +val('shapeSpeed')
    };
  }

  function send() { socket.emit('settings', getSettings()); }
  function pulse() { socket.emit('settings', { ...getSettings(), pulse: true }); }

  let pings = [], pc = 0;
  function ping() { pings = []; pc = 0; log('--- ping x10 ---'); doPing(); }
  function doPing() {
    if (pc >= 10) { const a = pings.reduce((a,b)=>a+b,0)/pings.length; log(`avg=${a.toFixed(1)}ms min=${Math.min(...pings)}ms max=${Math.max(...pings)}ms`); return; }
    socket.emit('ping-test', { index: pc, sent: Date.now() }); pc++;
  }
  socket.on('pong-test', (d) => { const rtt = Date.now()-d.sent; pings.push(rtt); log(`  #${d.index+1}: ${rtt}ms`); setTimeout(doPing, 50); });

  function burst(n) { log(`--- burst ${n} ---`); const t=Date.now(); for(let i=0;i<n;i++) socket.emit('burst',{index:i,total:n,sent:t}); log(`sent ${n} in ${Date.now()-t}ms`); }
  socket.on('burst-ack', (d) => { log(`receiver: ${d.total} in ${d.elapsed}ms (${d.rate.toFixed(0)} msg/s)`); });

  function stream(fps) {
    const dur=5000, iv=1000/fps; let n=0; const t0=Date.now();
    log(`--- stream ${fps}fps for 5s ---`);
    const tm = setInterval(() => {
      if (Date.now()-t0 >= dur) { clearInterval(tm); log(`sent ${n} frames (${(n/((Date.now()-t0)/1000)).toFixed(1)} fps)`); return; }
      socket.emit('settings', getSettings()); n++;
    }, iv);
  }

  function log(m) { const el=document.getElementById('results'); el.textContent+=m+'\n'; el.scrollTop=el.scrollHeight; }

  setTimeout(send, 500);
</script>
</body>
</html>
